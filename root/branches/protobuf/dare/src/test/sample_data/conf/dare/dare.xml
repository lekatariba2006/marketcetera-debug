<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">
  <import resource="db.xml"/>
  <import resource="filters/main.xml"/>
  <import resource="provisioning.xml"/>
  <import resource="sessionAttributeDescriptors.xml"/>
  <!-- FIX session settings -->
  <bean id="hibernateMessageStoreConfiguration" class="org.marketcetera.fix.store.HibernateMessageStoreConfiguration"/>
  <bean id="fixSettingsProviderFactory" class="org.marketcetera.core.fix.FixSettingsProviderFactoryImpl" depends-on="hibernateMessageStoreConfiguration">
    <property name="messageStoreFactoryClass" value="org.marketcetera.fix.store.HibernateMessageStoreFactory"/>
    <property name="logFactoryClass" value="org.marketcetera.quickfix.ObservableLogFactory"/>
    <property name="messageFactory" ref="messageFactory"/>
    <property name="acceptorHost" value="${metc.acceptor.qf.host}"/>
    <property name="acceptorPort" value="${metc.acceptor.qf.port}"/>
  </bean>
  <bean id="fixSessionProvider" class="org.marketcetera.fix.dao.PersistentFixSessionProvider"/>
  <bean id="dareQuickFixSender" class="org.marketcetera.quickfix.QuickFIXSenderImpl"/>
  <!-- unique id generator -->
  <bean id="idFactory" class="org.marketcetera.trade.dao.DatabaseIDFactory" init-method="init" depends-on="clusterService"/>
  <!-- DARE object -->
  <bean id="messageFactory" class="quickfix.DefaultMessageFactory"/>
  <bean id="dare" class="org.marketcetera.dare.DeployAnywhereRoutingEngine">
    <property name="allowDeliverToCompID" value="true"/>
    <property name="dontForwardMessages" value="A,0,1,2,4,5"/>
    <property name="forwardMessages" value=""/>
    <property name="executionPoolDelay" value="${metc.executionPoolDelay}"/>
    <property name="executionPoolTtl" value="${metc.executionPoolTtl}"/>
    <property name="maxExecutionPools" value="${metc.maxExecutionPools}"/>
    <!-- property name="fixInjectorDirectory" value="/tmp/injector-instance"/-->
  </bean>
  <!-- Outgoing message factory -->
  <bean id="outgoingMessageFactory" class="org.marketcetera.trade.dao.PersistentOutgoingMessageFactory"/>
  <!-- DARE User Manager -->
  <bean id="userService" class="org.marketcetera.admin.service.impl.UserServiceImpl"/>
  <!-- DARE Client Session Factory -->
  <bean id="clientSessionFactory" class="org.marketcetera.dare.DareClientSessionFactory"/>
  <!-- DARE Session Manager -->
  <bean id="dareSessionManager" class="org.marketcetera.util.ws.stateful.SessionManager">
    <constructor-arg ref="clientSessionFactory"/>
    <constructor-arg value="-1"/> <!-- infinite session life, otherwise specify a ms value -->
  </bean>
  <!-- DARE Authenticator -->
  <bean id="dbAuthenticator" class="org.marketcetera.admin.auth.DBAuthenticator"/>
  <!-- DARE Web Server -->
  <bean id="dareWebServer" class="org.marketcetera.util.ws.stateful.Server">
    <constructor-arg value="${metc.ws.host}"/> <!-- web-services hostname -->
    <constructor-arg value="${metc.ws.port}"/> <!-- web-services port -->
    <constructor-arg ref="dbAuthenticator"/>
    <constructor-arg ref="dareSessionManager"/>
  </bean>
  <!--  DARE RPC Service -->
  <bean id="rpcService" class="org.marketcetera.rpc.server.RpcServer">
    <property name="description" value="DARE RPC Service"/>
    <property name="hostname" value="${metc.ws.host}"/>
    <property name="port" value ="${metc.rpc.port}"/>
    <property name="serverServiceDefinitions">
      <list>
        <bean id="adminRpcService" class="org.marketcetera.admin.rpc.AdminRpcService"/>
      </list>
    </property>
  </bean>
  <!-- message ownership -->
  <bean id="messageOwnerService" class="org.marketcetera.trade.service.impl.MessageOwnerServiceImpl"/>
  <!-- user attribute service -->
  <bean id="userAttributeService" class="org.marketcetera.admin.service.impl.UserAttributeServiceImpl"/>
  <!-- DARE ID Factory -->
  <bean id="dareIdFactory" class="org.marketcetera.core.LocalIDFactory" init-method="init">
    <constructor-arg ref="idFactory"/>
  </bean>
  <bean id="brokerSelector" class="org.marketcetera.trade.BasicSelector">
    <property name="defaultBroker" value="exsim"/>
  </bean>
  <bean class="org.marketcetera.ors.OptionRootUnderlyingMap">
    <property name="filename" value="${metc.optionroot.map.file}"/>
    <property name="includeTypes" value="EU,EL"/>
  </bean>
  <!-- factories -->
  <bean id="adminClientFactory" class="org.marketcetera.admin.AdminRpcClientFactory"/>
  <bean id="userFactory" class="org.marketcetera.admin.impl.SimpleUserFactory"/>
  <bean id="fixSessionFactory" class="org.marketcetera.fix.dao.PersistentFixSessionFactory"/>
  <bean id="fixSessionAttributeDescriptorFactory" class="org.marketcetera.fix.dao.PersistentFixSessionAttributeDescriptorFactory"/>
  <bean id="permissionFactory" class="org.marketcetera.admin.dao.PersistentPermissionFactory"/>
  <bean id="roleFactory" class="org.marketcetera.admin.dao.PersistentRoleFactory"/>
  <bean id="userAttributeFactory" class="org.marketcetera.admin.dao.PersistentUserAttributeFactory"/>
  <bean id="supervisorPermissionFactory" class="org.marketcetera.admin.dao.PersistentSupervisorPermissionFactory"/>
  <bean id="mutableActiveFixSessionFactory" class="org.marketcetera.fix.impl.SimpleActiveFixSessionFactory"/>
  <bean id="serverFixSessionFactory" class="org.marketcetera.fix.impl.SimpleServerFixSessionFactory"/>
</beans>
