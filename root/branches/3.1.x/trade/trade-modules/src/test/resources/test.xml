<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">
  <util:list id="propertiesFiles">
    <value>file:target/local.properties</value>
  </util:list>
  <bean class= "org.springframework.beans.factory.config.PreferencesPlaceholderConfigurer">
    <property name="locations" ref="propertiesFiles"/>
  </bean>
  <jpa:repositories base-package="org.marketcetera"/>
  <tx:annotation-driven/>
  <context:component-scan base-package="org.marketcetera"/>
  <bean id="moduleManager" class="org.marketcetera.module.ModuleManager" init-method="init" destroy-method="stop"/>
  <bean id="simpleClusterService" class="org.marketcetera.cluster.SimpleClusterService"/>
  <bean id="messageFactory" class="quickfix.DefaultMessageFactory"/>
  <bean id="brokerFactory" class="org.marketcetera.fix.impl.SimpleBrokerFactory"/>
  <bean id="incomingMessageService" class="org.marketcetera.fix.service.IncomingMessageServiceImpl"/>
  <bean id="fixSessionFactory" class="org.marketcetera.fix.impl.SimpleFixSessionFactory"/>
  <bean id="testSelector" class="org.marketcetera.trade.service.TestBrokerSelector"/>
  <bean id="fixSettingsProviderFactory" class="org.marketcetera.fix.FixSettingsProviderFactoryImpl">
    <property name="messageStoreFactoryClass" value="org.marketcetera.fix.store.NoopStoreFactory"/>
    <property name="logFactoryClass" value="quickfix.SLF4JLogFactory"/>
    <property name="messageFactory" ref="messageFactory"/>
    <property name="acceptorHost" value="localhost"/>
    <property name="acceptorPort" value="21345"/>
  </bean>
  <bean id="userFactory" class="org.marketcetera.admin.user.PersistentUserFactory"/>
  <bean id="userService" class="org.marketcetera.admin.service.impl.UserServiceImpl"/>
  <bean id="outgoingMessageFactory" class="org.marketcetera.trade.dao.PersistentOutgoingMessageFactory"/>
  <bean id="tradeService" class="org.marketcetera.trade.service.impl.TradeServiceImpl"/>
  <bean id="messageOwnerService" class="org.marketcetera.trade.service.impl.MessageOwnerServiceImpl"/>
  <bean id="outgoingMessageService" class="org.marketcetera.trade.service.impl.OutgoingMessageServiceImpl"/>
  <bean id="brokerService" class="org.marketcetera.brokers.service.BrokerServiceImpl"/>
  <bean id="fixSessionsProvider" class="org.marketcetera.brokers.service.InMemoryFixSessionProvider">
    <property name="fixSessions">
      <list>
        <ref bean="initiators"/>
        <ref bean="acceptors"/>
      </list>
    </property>
  </bean>
  <bean id="initiators" class="org.marketcetera.fix.provisioning.FixSessionsDescriptor">
    <property name="sessionSettings" ref="initiatorSettings"/>
    <property name="fixSessions">
      <list>
        <bean id="initiator1" class="org.marketcetera.fix.provisioning.FixSessionDescriptor">
          <property name="name" value="Initiator1"/>
          <property name="brokerId" value="initiator1"/>
          <property name="description" value="Test initiator 1"/>
          <property name="sessionSettings" ref="initiator1Settings"/>
          <property name="host" value="localhost"/>
          <property name="port" value="21345"/>
        </bean>
        <bean id="initiator2" class="org.marketcetera.fix.provisioning.FixSessionDescriptor">
          <property name="name" value="Initiator2"/>
          <property name="brokerId" value="initiator2"/>
          <property name="mappedBrokerId" value="initiator1"/>
          <property name="description" value="Test initiator 2"/>
          <property name="sessionSettings" ref="initiator2Settings"/>
          <property name="host" value="localhost"/>
          <property name="port" value="21345"/>
        </bean>
      </list>
    </property>
  </bean>
  <bean id="sessionCustomization1" class="org.marketcetera.fix.provisioning.SimpleSessionCustomization">
    <property name="name" value="sessionCustomization1"/>
    <property name="orderModifiers">
      <list>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10000"/>
          <property name="value" value="bogus-value"/>
        </bean>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10000"/>
          <property name="value" value="10000-sessionCustomization1"/>
        </bean>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10001"/>
          <property name="value" value="10001-sessionCustomization1"/>
        </bean>
      </list>
    </property>
  </bean>
  <bean id="sessionCustomization2" class="org.marketcetera.fix.provisioning.SimpleSessionCustomization">
    <property name="name" value="sessionCustomization2"/>
    <property name="orderModifiers">
      <list>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10001"/>
          <property name="value" value="bogus-value"/>
        </bean>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10001"/>
          <property name="value" value="10001-sessionCustomization2"/>
        </bean>
        <bean class="org.marketcetera.trade.service.FieldSetterMessageModifier">
          <property name="field" value="10002"/>
          <property name="value" value="10002-sessionCustomization2"/>
        </bean>
      </list>
    </property>
  </bean>
  <bean id="initiatorSettings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="ConnectionType" value="initiator"/>
        <entry key="HeartBtInt" value="1"/>
        <entry key="SLF4JLogHeartbeats" value="N"/>
        <entry key="StartTime" value="00:00:00"/>
        <entry key="EndTime" value="00:00:00"/>
        <entry key="TimeZone" value="US/Pacific"/>
        <entry key="UseDataDictionary" value="Y"/>
        <entry key="ReconnectInterval" value="1"/>
        <entry key="ResetOnLogon" value="Y"/>
        <entry key="ResetOnLogout" value="Y"/>
        <entry key="ResetOnDisconnect" value="Y"/>
        <entry key="ResetOnError" value="Y"/>
        <entry key="ValidateUserDefinedFields" value="N"/>
      </map>
    </property>
  </bean>
  <bean id="initiator1Settings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="BeginString" value="FIX.4.2"/>
        <entry key="DataDictionary" value="FIX42.xml"/>
        <entry key="SenderCompID" value="MATP"/>
        <entry key="TargetCompID" value="TARGET1"/>
        <entry key="org.marketcetera.sessioncustomization" value="sessionCustomization1"/>
      </map>
    </property>
  </bean>
  <bean id="initiator2Settings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="BeginString" value="FIX.4.2"/>
        <entry key="DataDictionary" value="FIX42.xml"/>
        <entry key="SenderCompID" value="MATP"/>
        <entry key="TargetCompID" value="TARGET2"/>
        <entry key="org.marketcetera.sessioncustomization" value="sessionCustomization2"/>
      </map>
    </property>
  </bean>
  <bean id="acceptors" class="org.marketcetera.fix.provisioning.FixSessionsDescriptor">
    <property name="sessionSettings" ref="acceptorSettings"/>
    <property name="fixSessions">
      <list>
        <bean id="acceptor1" class="org.marketcetera.fix.provisioning.FixSessionDescriptor">
          <property name="name" value="Acceptor1"/>
          <property name="brokerId" value="acceptor1"/>
          <property name="description" value="Test Acceptor 1"/>
          <property name="sessionSettings" ref="acceptor1Settings"/>
        </bean>
        <bean id="acceptor2" class="org.marketcetera.fix.provisioning.FixSessionDescriptor">
          <property name="name" value="Acceptor2"/>
          <property name="brokerId" value="acceptor2"/>
          <property name="description" value="Test Acceptor 2"/>
          <property name="sessionSettings" ref="acceptor2Settings"/>
        </bean>
      </list>
    </property>
  </bean>
  <bean id="acceptorSettings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="ConnectionType" value="acceptor"/>
        <entry key="SLF4JLogHeartbeats" value="N"/>
        <entry key="StartTime" value="00:00:00"/>
        <entry key="EndTime" value="00:00:00"/>
        <entry key="TimeZone" value="US/Pacific"/>
        <entry key="UseDataDictionary" value="Y"/>
        <entry key="ReconnectInterval" value="1"/>
        <entry key="ResetOnLogon" value="Y"/>
        <entry key="ResetOnLogout" value="Y"/>
        <entry key="ResetOnDisconnect" value="Y"/>
        <entry key="ResetOnError" value="Y"/>
        <entry key="ValidateUserDefinedFields" value="N"/>
      </map>
    </property>
  </bean>
  <bean id="acceptor1Settings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="BeginString" value="FIX.4.2"/>
        <entry key="DataDictionary" value="FIX42.xml"/>
        <entry key="SenderCompID" value="TARGET1"/>
        <entry key="TargetCompID" value="MATP"/>
      </map>
    </property>
  </bean>
  <bean id="acceptor2Settings" class="org.marketcetera.fix.provisioning.SessionSettingsDescriptor">
    <property name="sessionSettings">
      <map>
        <entry key="BeginString" value="FIX.4.2"/>
        <entry key="DataDictionary" value="FIX42.xml"/>
        <entry key="SenderCompID" value="TARGET2"/>
        <entry key="TargetCompID" value="MATP"/>
      </map>
    </property>
  </bean>
  <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/>
  <bean id="metc_sql_pool" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close">
    <property name="dataSourceName" value="test"/>
    <property name="driverClass" value="${metc.jdbc.driver}"/>
    <property name="jdbcUrl" value="${metc.jdbc.url}"/>
    <property name="user" value="${metc.jdbc.user}"/>
    <property name="password" value="${metc.jdbc.password}"/>
    <property name="maxPoolSize" value="50"/>
    <property name="preferredTestQuery" value="${metc.jdbc.testquery}"/>
    <property name="testConnectionOnCheckout" value="true"/>
    <property name="checkoutTimeout" value="10000"/>
  </bean>
  <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="metc_sql_pool"/>
    <property name="persistenceUnitName" value="test"/>
    <property name="jpaVendorAdapter">
      <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"/>
    </property>
    <property name="jpaProperties">
      <props>
        <prop key="hibernate.dialect">${metc.hibernate.dialect}</prop>
        <prop key="hibernate.hbm2ddl.auto">create</prop>
        <prop key="hibernate.show_sql">false</prop>
        <prop key="hibernate.format_sql">false</prop>
        <prop key="hibernate.jdbc.batch_size">100</prop>
        <prop key="hibernate.order_inserts">true</prop>
        <prop key="hibernate.order_updates">true</prop>
        <prop key="hibernate.jdbc.batch_versioned_data">true</prop>
      </props>
    </property>
    <property name="packagesToScan">
      <list>
        <value>org.marketcetera</value>
      </list>
    </property>
  </bean>
  <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="entityManagerFactory" />
  </bean>
</beans>
